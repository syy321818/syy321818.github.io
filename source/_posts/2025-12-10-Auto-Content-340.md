---
title: "Fix Error 91: Object Variable Not Set When Using Find With Protected Sheets"
date: 2025-12-10 14:10:13
tags:
  - VBA
  - Troubleshooting
  - Runtime Error 91
  - Excel Automation
categories:
  - VBA Error Encyclopedia
description: "Solving Runtime Error 91 'Object variable not set' when Find() returns Nothing on protected Excel sheets. Includes robust error handling."
keywords: [Excel VBA, Runtime Error 91, fix Error 91 excel, Find function protected sheet vba]
---

## The Error

- **Error Code:** Runtime Error 91  
- **Error Message:** "Object variable or With block variable not set"  
- **The Scenario:** Occurs when using `Range.Find()` method on a protected worksheet where no match is found, AND attempting to use the result without checking `Nothing` first.

```vba
' Example triggering code:
Sub FindFailingExample()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Worksheets("Data")
    ws.Protect Password:="secret"  ' Protection enabled
    
    Dim foundCell As Range
    Set foundCell = ws.Cells.Find(What:="NonExistentValue")
    
    ' This line triggers Error 91 if value not found:
    MsgBox foundCell.Address  
End Sub
```

## The Root Cause

When `Find()` returns `Nothing` (no match found) on a protected sheet, VBA cannot implicitly create a temporary range reference. Combined with missing `Nothing` checks, this raises Error 91. Protection changes `Find()`'s failure mode compared to unprotected sheets.

``

## The Fix

### Method 1: The Quick Fix
Always check for `Nothing` before using Find results:

```vba
If Not foundCell Is Nothing Then
    MsgBox foundCell.Address
Else
    MsgBox "Value not found"
End If
```

### Method 2: The Robust Fix
Add protection-aware error handling:

```vba
Sub SafeFind()
    On Error GoTo ErrorHandler
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Worksheets("Data")
    
    ' Temporarily unprotect if needed
    If ws.ProtectContents Then
        ws.Unprotect Password:="secret"
        Dim wasProtected As Boolean
        wasProtected = True
    End If
    
    Dim foundCell As Range
    Set foundCell = ws.Cells.Find(What:="TargetValue")
    
    If Not foundCell Is Nothing Then
        MsgBox "Found at " & foundCell.Address
    Else
        MsgBox "Value not found"
    End If
    
Cleanup:
    If wasProtected Then ws.Protect Password:="secret"
    Exit Sub
    
ErrorHandler:
    MsgBox "Error " & Err.Number & ": " & Err.Description, vbCritical
    Resume Cleanup
End Sub
```

**Why this works:** Method 2 handles both the object reference issue AND sheet protection states, preventing Error 91 while maintaining security.

## Prevention

1. **Always Check Find Results:** Never assume `Find()` will succeed  
2. **Use Protection-Aware Code:** Temporarily unprotect/reprotect sheets when searching  
3. **Implement Error Handlers:** Wrap search operations in `On Error` blocks  
4. **Add Validation:** Verify sheet existence and protection status before operations  

```vba
' Prevention template:
Sub SafeFindPattern()
    On Error GoTo ErrHandler
    ' 1. Verify worksheet exists
    ' 2. Check/handle protection
    ' 3. Always validate Find() result
    ' 4. Clean up protection state
    Exit Sub
ErrHandler:
    ' Log/report error
End Sub
