---
title: "Fix Error 52: Bad File Name When Accessing Network Drives with VBA"
date: 2025-12-10 14:06:30
tags:
  - VBA
  - Troubleshooting
  - Runtime Error 52
  - Excel Automation
categories:
  - VBA Error Encyclopedia
description: "Resolve Runtime Error 52 'Bad File Name' in Excel VBA when accessing mapped network drives with UNC paths or expired connections."
keywords: [Excel VBA, Runtime Error 52, fix Error 52 in excel, network drive vba error, bad filename vba]

---

## The Error

- **Error Code:** Runtime Error 52
- **Error Message:** "Bad file name or number"
- **The Scenario:** Occurs when attempting to access files/folders through VBA FileSystemObject or legacy file I/O statements (`Open`, `Dir`) on:
  - Mapped network drives (`Z:\Reports\`)
  - UNC paths (`\\server\share\`)
  - Recently disconnected drives

## The Root Cause

Microsoft VBA throws Error 52 when:
1. **Drive Mapping Issues:** The mapped drive letter appears in Explorer but has been disconnected (common after VPN drops or sleep/wake cycles)
2. **UNC Path Limitations:** Legacy VBA file operations (`FileCopy`, `Name`) reject UNC paths
3. **Permission Escalation:** The script lacks credentials to access the network resource
4. **Path Syntax Errors:** Double quotes/special characters in paths trigger false positives

``

## The Fix

### Method 1: The Quick Fix (Force UNC Path)

```vba
' Replace mapped drive with UNC path
Dim filePath As String
filePath = Replace("Z:\Reports\data.xlsx", "Z:\", "\\corp-server\finance\")

Dim fso As Object
Set fso = CreateObject("Scripting.FileSystemObject")
If fso.FileExists(filePath) Then
    Workbooks.Open filePath
Else
    MsgBox "File not found", vbExclamation
End If
```

### Method 2: The Robust Fix (Network Drive Verification)

```vba
Function IsNetworkDriveAvailable(driveLetter As String) As Boolean
    On Error Resume Next
    Dim uncPath As String
    uncPath = CreateObject("WScript.Network").EnumNetworkDrives()(driveLetter)
    IsNetworkDriveAvailable = (Err.Number = 0 And uncPath <> "")
    On Error GoTo 0
End Function

Sub SafeOpenNetworkFile()
    Dim fso As Object, fullPath As String
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    ' Always use UNC conversion
    fullPath = Application.Replace("Z:\Reports\data.xlsx", "Z:\", _
               ResolveNetworkPath("Z:\"))
    
    If fso.FileExists(fullPath) Then
        Workbooks.Open fullPath
    Else
        MsgBox "Network resource unavailable", vbCritical
    End If
End Sub
```

**Why this works:** Directly resolving UNC paths bypasses drive mapping dependencies and handles connection drops gracefully.

## Prevention

1. **Always Use UNC Paths:** Replace all drive letters (`Z:\`) with server paths (`\\server\share\`)
2. **Pre-Visibility Check:** Implement network drive verification before file operations:
   ```vba
   If Not DriveExists("Z:") Then MapNetworkDrive "Z:", "\\server\share"
   ```
3. **Modern Alternatives:** Switch to PowerShell/VBA combo for resilient network access:
   ```vba
   ' Use PowerShell to test network paths
   Function IsPathReachable(path As String) As Boolean
       Dim psCommand As String
       psCommand = "Test-Path -Path '" & path & "' -ErrorAction SilentlyContinue"
       IsPathReachable = (CreateObject("WScript.Shell").Run("powershell.exe " & psCommand, 0, True) = 0)
   End Function
   ```
4. **Timeouts Handling:** Wrap network calls with `Application.OnTime` for auto-retry logic